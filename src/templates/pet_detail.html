{% extends "base.html" %}

{% block title %}{{ pet.name }} - Take A Paw{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <img src="{{ pet.image }}" class="img-fluid rounded" alt="{{ pet.name }}" 
             style="max-height: 500px; object-fit: cover;">
    </div>
    <div class="col-md-6">
        <h1>{{ pet.name }}</h1>
        <p class="lead">{{ pet.species }} • {{ pet.breed }}</p>
        
        <div class="mb-3">
            <strong>Age:</strong> {{ pet.age }}<br>
            <strong>Gender:</strong> {{ pet.gender }}<br>
            <strong>Location:</strong> {{ pet.location }}<br>
            <strong>Source:</strong> 
            {% if pet.source == 'api' %}
                <span class="badge bg-info">Real Shelter Pet 🐾</span>
            {% else %}
                <span class="badge bg-secondary">Local Rescue 🏠</span>
            {% endif %}
        </div>
        
        {% if pet.personality %}
        <div class="mb-3">
            <strong>Personality:</strong>
            {% for trait in pet.personality %}
            <span class="badge bg-light text-dark me-1">{{ trait }}</span>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="mb-4">
            <h5>About {{ pet.name }}</h5>
            <p>{{ pet.description }}</p>
        </div>
        
        {% if not pet.adopted %}
        <div class="d-grid gap-2 d-md-flex">
            <!-- FIXED: Use encoded pet ID for adoption -->
            <a href="{{ url_for('adopt_pet_form', pet_id=pet.id|urlencode) }}" class="btn btn-success btn-lg me-md-2">
                🏠 Adopt {{ pet.name }}
            </a>
            <button class="btn btn-outline-primary btn-lg favorite-btn" data-pet-id="{{ pet.id }}">
                ❤️ Add to Favorites
            </button>
        </div>
        {% else %}
        <div class="alert alert-success">
            <h5>🎉 {{ pet.name }} has found a loving home!</h5>
            <p class="mb-0">Thank you to everyone who showed interest in adopting {{ pet.name }}.</p>
        </div>
        {% endif %}
        
        <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Back to All Pets</a>
    </div>
</div>
<script>
    // Favorite button functionality
    document.addEventListener('DOMContentLoaded', function() {
        const favoriteButtons = document.querySelectorAll('.favorite-btn');
        
        favoriteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const petId = this.getAttribute('data-pet-id');
                console.log('Favorite clicked for pet:', petId);
                
                fetch(`/favorite/${petId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Favorite response:', data);
                    if (data.success) {
                        // Toggle heart icon
                        if (data.message.includes('Added')) {
                            this.innerHTML = '❤️ Remove Favorite';
                            this.classList.remove('btn-outline-primary');
                            this.classList.add('btn-primary');
                        } else {
                            this.innerHTML = '❤️ Add to Favorites';
                            this.classList.remove('btn-primary');
                            this.classList.add('btn-outline-primary');
                        }
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error updating favorites');
                });
            });
        });
    });
    </script>
{% endblock %}